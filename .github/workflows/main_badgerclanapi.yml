deploy:
  runs-on: windows-latest
  needs: build
  environment:
    name: 'Production'
    url: ${{ steps.deploy-to-webapp.outputs.webapp-url }}
  permissions:
    id-token: write
    contents: read

  steps:
    - name: Download artifact from build job
      uses: actions/download-artifact@v4
      with:
        name: .net-app

    # List the contents of the workspace to verify the location of the downloaded files
    - name: List downloaded files
      run: dir ${{ github.workspace }}

    - name: Login to Azure
      uses: azure/login@v2
      with:
        client-id: ${{ secrets.AZUREAPPSERVICE_CLIENTID_A981676BFC5E46519C8BE0D23297F66C }}
        tenant-id: ${{ secrets.AZUREAPPSERVICE_TENANTID_E9E30F6621284CBD9C060F49F05A0CEB }}
        subscription-id: ${{ secrets.AZUREAPPSERVICE_SUBSCRIPTIONID_E8FC318A09AC451E8CCDD513EA19AADD }}

    - name: Deploy to Azure Web App
      id: deploy-to-webapp
      uses: azure/webapps-deploy@v3
      with:
        app-name: 'BadgerClanApi'
        slot-name: 'Production'
        package: ${{ github.workspace }}/myapp
